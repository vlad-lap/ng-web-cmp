# Web Component from Angular project

## 1. Create new Angular project

## 2. Install dependencies

````
ng add @angular/elements
npm i @webcomponents/custom-elements --save
````

The dependencies below are required for building a web component:

`npm i --save-dev concat fs-extra`

## 3. Add polyfills to `polyfills.ts`

````
import '@webcomponents/custom-elements/src/native-shim';
import '@webcomponents/custom-elements/custom-elements.min';
 
 /*The polyfill below is required for correct work in IE11*/
 import 'core-js/es/reflect';
````

## 4. Edit `app.module`

Remove all `bootstrap`, add component that will be generated as a web component to `entryComponents` and define a web component in `ngDoBootstrap` method:

````
import { BrowserModule } from '@angular/platform-browser';
import {Injector, NgModule} from '@angular/core';

import { AppComponent } from './app.component';
import { TestWebComponent } from './test-web/test-web.component';
import {createCustomElement} from '@angular/elements';

@NgModule({
  declarations: [
    AppComponent,
    TestWebComponent
  ],
  imports: [
    BrowserModule
  ],
  providers: [],
  entryComponents: [TestWebComponent]
})
export class AppModule {
  constructor(private injector: Injector) {}

  ngDoBootstrap() {
    const webCmp = createCustomElement(TestWebComponent, { injector: this.injector });
    customElements.define('test-web-cmp', webCmp);
  }
}

````

## 5. Create `build.js` script in the root folder

````
const fs = require('fs-extra');
const concat = require('concat');

(async function build() {
    const files = [
        './dist/test-web-cmp/runtime-es5.js',
        './dist/test-web-cmp/polyfills-es5.js',
        './dist/test-web-cmp/scripts.js',
        './dist/test-web-cmp/main-es5.js'
    ]; // files generated by build

    await fs.ensureDir('test'); // create folder 'test' if it doesn't exist
    await concat(files, 'test/test-web-cmp.js'); // merge files into one which will be exported
})();
````

I use ES5 scripts instead of ES2015 for correct work in IE.
## 6. Build
Run `ng build --prod --outputHashing=none && node build.js` (I added a shortcut to `package.json`: `npm run build:webcomponent`).

## 7. Use a generated script and an element
You can see the example in `index.html`:
````
<script src="./test/test-web-cmp.js"></script>
...
<test-web-cmp title="Test Web Component"></test-web-cmp>
````
